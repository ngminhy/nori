@model IEnumerable<Biz4CMS.ViewModels.ProductCat>

@{
    ViewBag.Title = "Product order ";
    Layout = "~/Views/Shared/_LayoutNori.cshtml";
}

<style>
    #limheight {
        -webkit-column-count: 3;
        -moz-column-count: 3;
        column-count: 3; /*3 is just placeholder -- can be anything*/
    }

        #limheight li {
            display: inline-block;
            padding-bottom: 20px;
        }
</style>


@{  var i = 1;
    var preCat = 0;
    var CakeFillers = (List<Biz4CMS.Models.CakeFiller>)ViewData["CakeFillers"];
}

<div>
    @foreach (var item in Model)
    {

        if (preCat != item.CategoryId)
        {
            @:</div><div class="pheadline"><h2>@item.CategoryName </h2></div><div class="row">
    }
        @Html.Partial("_productItem", item)
        preCat = item.CategoryId;
        i++;
    }
</div>



<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-sm">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Choose Your Dressing  <b id="maxchoise">Max: </b></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <ul id="limheight">
                            @foreach (var filler in CakeFillers)
                            {
                                <li>
                                
                                    <div class="checkbox">
                                        <label><input type="checkbox" name="chkCakeFiller[]" value="@filler.CakeFillerId">@filler.Name</label>
                                    </div>
                                </li>
                            }
                           

                        </ul>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="addCakeFiller">Add</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>
<script>
    $(function(){
        var MaxFiller = $("#MaxFiller").val();
        var ProductId = $("#ProductId").val();
        $("#maxchoise").text("Max: " + MaxFiller);
        function updateCounter(chk) {
            var len = $("input[name='chkCakeFiller[]']:checked").length;

            if (len > MaxFiller) {
                chk.checked = false;
                alert("You had max choise!");
            }
        }

        $("input[name='chkCakeFiller[]']").on("change", function () {
            updateCounter(this);
        });
        $("#addCakeFiller").click(function () {
            var chkCake = $("input[name='chkCakeFiller[]']:checked").map(function (_, el) {
                return $(el).val();
            }).get();
            //alert(chkCake);
            $.get("/ShoppingCart/AddToCart/" + ProductId + "?listCakeFiller=" + chkCake, function (data) {
                $('#myModal').modal('toggle');
                location.href = "/ShoppingCart";
            });
          
           
        })
    })
</script>


